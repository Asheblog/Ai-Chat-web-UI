# =======================================================
# AI聊天平台环境变量配置示例
# 复制此文件为 .env 并根据需要修改配置
# =======================================================

# ==================== 环境配置 ====================
# 运行环境: development | production
NODE_ENV=production

# ==================== 后端配置 ====================

# —— 推理链（Chain of Thought / Reasoning）——
# 是否启用推理链识别（含供应商 reasoning_content 以及标签抽取）。默认 true
REASONING_ENABLED=true

# 是否将思维链保存到数据库 messages.reasoning，默认 true（按你的要求）
REASONING_SAVE_TO_DB=true

# 默认是否展开思维链折叠块（仅影响前端默认行为；实际前端也可自行记忆状态）
REASONING_DEFAULT_EXPAND=false

# 推理标签模式：default/custom/off
# default 使用常见标签（<think>…</think>、<|begin_of_thought|>… 等）
# custom 使用自定义标签（下行 JSON 必须为 [startTag, endTag]）
# off    关闭标签抽取（仍会处理供应商原生 reasoning_content）
REASONING_TAGS_MODE=default

# 自定义标签（JSON 字符串），示例：["<think>","</think>"]
#REASONING_CUSTOM_TAGS=["<think>","</think>"]

# 服务端流分片最小聚合（不强制使用，仅作参考默认值）
STREAM_DELTA_CHUNK_SIZE=1

# Agent 工具最大调用次数（0 表示无限制，1-20 表示硬限制，默认 4）
#AGENT_MAX_TOOL_ITERATIONS=4

# —— 供应商参数（可选） ——
# OpenAI reasoning effort（low|medium|high）。为空表示不设置，由模型默认处理
#OPENAI_REASONING_EFFORT=medium

# Ollama think 开关（仅在对接 Ollama 有效）
#OLLAMA_THINK=false
# 后端服务端口（宿主机对外暴露端口）
BACKEND_PORT=3001

# 数据库连接 (SQLite文件路径)
DATABASE_URL=file:./data/app.db

# JWT密钥 (生产环境请务必修改！)
JWT_SECRET=aichat-super-secret-jwt-key-2025-production-change-me

# API Key 加密密钥（生产环境请务必修改！用于加密存储系统连接的 apiKey，实际使用时请将此条注释去掉，可加强安全性）
# ENCRYPTION_KEY=aichat-encryption-key-2025-production-change-me

# ==================== 首次启动引导（可选） ====================
# 说明：当 DB_INIT_ON_START=true 或首次初始化数据库时，会将 setup_state=required，
# 前端启动后会进入“初始化向导”（需管理员登录才能继续，支持全站跳过/完成）。
# 如需在已完成的环境中临时强制显示向导，可设置 FORCE_SETUP_WIZARD=true（仅在 setup_state 未写入时生效）。
#FORCE_SETUP_WIZARD=true

# Python 受管运行环境：容器启动时是否自动执行一次 reconcile（默认 true）
#PYTHON_RUNTIME_RECONCILE_ON_START=true

# ==================== Workspace Agent（会话级沙箱） ====================
# 是否启用 workspace 工具链（默认 true）
#WORKSPACE_TOOL_ENABLE=true
# 会话 workspace 根目录（默认：<APP_DATA_DIR|DATA_DIR|./data>/workspaces/chat）
#WORKSPACE_ROOT_DIR=/app/data/workspaces/chat
# artifact 下载有效期（分钟，默认 60）
#WORKSPACE_ARTIFACT_TTL_MINUTES=60
# workspace 空闲回收时间（分钟，默认 1440 = 24h）
#WORKSPACE_IDLE_TTL_MINUTES=1440
# 清理器间隔（分钟，默认 5）
#WORKSPACE_CLEANUP_INTERVAL_MINUTES=5
# 单会话 workspace 总大小上限（字节，默认 1073741824 = 1GB）
#WORKSPACE_MAX_BYTES=1073741824
# 单个 artifact 大小上限（字节，默认 104857600 = 100MB）
#WORKSPACE_ARTIFACT_MAX_BYTES=104857600
# 单条消息最多发布 artifact 数（默认 20）
#WORKSPACE_MAX_ARTIFACTS_PER_MESSAGE=20
# Python 单次执行超时（毫秒，默认 120000）
#WORKSPACE_RUN_TIMEOUT_MS=120000
# Python 执行网络模式：none|default（默认 none；若需要代码内直连外网可设 default）
#WORKSPACE_RUN_NETWORK_MODE=none
# Docker 运行镜像与资源限制（默认 python:3.11-slim / 1 CPU / 1G / 256 pids）
#WORKSPACE_DOCKER_IMAGE=python:3.11-slim
#WORKSPACE_DOCKER_CPUS=1.0
#WORKSPACE_DOCKER_MEMORY=1g
#WORKSPACE_DOCKER_PIDS_LIMIT=256
# artifact 下载签名密钥（未设置时回退 JWT_SECRET；生产建议显式配置）
#WORKSPACE_ARTIFACT_SIGNING_SECRET=replace-with-strong-secret
# workspace 工具读取/遍历限制
#WORKSPACE_LIST_MAX_ENTRIES=500
#WORKSPACE_READ_MAX_CHARS=120000
#WORKSPACE_GIT_CLONE_TIMEOUT_MS=120000
#WORKSPACE_PYTHON_INSTALL_TIMEOUT_MS=300000

# BREAKING：旧 python_tool_* 主机执行配置已下线（无迁移，直接替换）
# 仅保留 skills.enabled 中的 python-runner + workspace 工具链作为聊天侧执行入口。

# 默认上下文Token限制（建议 4000，过大将显著增加内存/延迟）
DEFAULT_CONTEXT_TOKEN_LIMIT=120000

# 默认管理员账户 (首次启动时创建)
DEFAULT_ADMIN_USERNAME=admin
DEFAULT_ADMIN_PASSWORD=admin123456

# CORS配置 (是否启用与允许来源)
# 若前端通过同源反代（推荐），可保持开启但无需严格限制来源
ENABLE_CORS=true
CORS_ORIGIN=http://localhost:3000

# 日志级别: debug | info | warn | error
LOG_LEVEL=info

# ==================== 前端配置 ====================
# 前端服务端口
FRONTEND_PORT=3000

# 前端访问后端API的地址（浏览器端使用相对路径，避免跨设备 localhost 问题）
NEXT_PUBLIC_API_URL=/api

# （可选）前端服务端反向代理目标，仅 Next.js 服务器使用，不暴露给浏览器
# 若使用 Docker Compose，前端容器会自动设置 BACKEND_HOST=backend 与 BACKEND_INTERNAL_PORT=8001
# BACKEND_HOST=localhost
# BACKEND_INTERNAL_PORT=8001

# ==================== 预留配置（按需启用） ====================
# Redis配置（当前版本默认未启用）
# REDIS_URL=redis://localhost:6379

# 邮件配置（当前版本默认未启用）
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your-email@gmail.com
# SMTP_PASS=your-app-password

# 聊天图片本地存储配置（可选）
# CHAT_IMAGE_DIR：图片保存目录，可填绝对路径或相对项目根目录的相对路径，默认 storage/chat-images
#CHAT_IMAGE_DIR=/data/aichat/chat-images
# CHAT_IMAGE_PUBLIC_PATH：浏览器访问图片的前缀路径，默认 /chat-images（反向代理需放行该路径）
#CHAT_IMAGE_PUBLIC_PATH=/chat-images
# CHAT_IMAGE_RETENTION_DAYS：图片保留天数，整数 >=0，默认 30；设为 0 表示仅保留当前会话，写入后立即清理老文件
#CHAT_IMAGE_RETENTION_DAYS=30
# BATTLE_RETENTION_DAYS：模型大乱斗历史保留天数，整数 >=0，默认 15；设为 0 表示关闭自动清理
#BATTLE_RETENTION_DAYS=15
# CHAT_IMAGE_BASE_URL：默认图片访问域名（含协议）。若系统设置中未填写，将使用此值或自动检测局域网地址
#CHAT_IMAGE_BASE_URL=https://chat.example.com

# ==================== 生产环境优化 ====================
# 生产环境请确保以下配置：
# 1. 修改JWT_SECRET为强密钥
# 2. 修改DEFAULT_ADMIN_USERNAME和DEFAULT_ADMIN_PASSWORD
# 3. 设置适当的CORS_ORIGIN
# 4. 启用HTTPS (反向代理配置)
# 5. 配置适当的日志级别
# 6. 设置资源限制 (docker-compose.yml中)
