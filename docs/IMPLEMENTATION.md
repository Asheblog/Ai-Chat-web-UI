# AI Chat Platform åç«¯å®ç°æ€»ç»“

## ğŸ“‹ å®ç°å®Œæˆæƒ…å†µ

### âœ… å·²å®ŒæˆåŠŸèƒ½

#### 1. é¡¹ç›®æ¶æ„å’Œé…ç½®
- [x] Monorepo é¡¹ç›®ç»“æ„
- [x] TypeScript é…ç½®
- [x] Prisma + SQLite æ•°æ®åº“é…ç½®
- [x] Docker é…ç½®å’Œéƒ¨ç½²è„šæœ¬
- [x] ç¯å¢ƒå˜é‡ç®¡ç†
- [x] å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒåˆ†ç¦»

#### 2. æ•°æ®åº“è®¾è®¡ (å®Œæ•´å®ç°)
- [x] User è¡¨ - ç”¨æˆ·ç®¡ç†
- [x] ModelConfig è¡¨ - æ¨¡å‹é…ç½®ç®¡ç†
- [x] ChatSession è¡¨ - èŠå¤©ä¼šè¯ç®¡ç†
- [x] Message è¡¨ - æ¶ˆæ¯è®°å½•
- [x] SystemSetting è¡¨ - ç³»ç»Ÿè®¾ç½®
- [x] å®Œæ•´çš„å¤–é”®å…³è”å’Œçº§è”åˆ é™¤

#### 3. ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [x] JWT Token è®¤è¯
- [x] å¯†ç  bcrypt å“ˆå¸Œå­˜å‚¨
- [x] ç”¨æˆ·æ³¨å†Œ/ç™»å½•/ç™»å‡º
- [x] è§’è‰²æƒé™ç®¡ç† (ADMIN/USER)
- [x] è®¤è¯ä¸­é—´ä»¶
- [x] å•ç”¨æˆ·/å¤šç”¨æˆ·æ¨¡å¼æ”¯æŒ

#### 4. æ¨¡å‹é…ç½®ç®¡ç†
- [x] ä¸ªäººæ¨¡å‹é…ç½® (CRUD)
- [x] ç³»ç»Ÿæ¨¡å‹é…ç½® (ç®¡ç†å‘˜)
- [x] API Key åŠ å¯†å­˜å‚¨ (AES)
- [x] æ¨¡å‹æƒé™æ§åˆ¶
- [x] æ¨¡å‹è®¿é—®éªŒè¯

#### 5. èŠå¤©æ ¸å¿ƒåŠŸèƒ½
- [x] ä¼šè¯ç®¡ç† (åˆ›å»ºã€åˆ é™¤ã€æŸ¥è¯¢)
- [x] æ¶ˆæ¯å­˜å‚¨å’ŒæŸ¥è¯¢
- [x] Token è®¡ç®— (tiktoken)
- [x] ä¸Šä¸‹æ–‡æ»‘åŠ¨çª—å£ç®¡ç†
- [x] æµå¼å“åº” (SSE)
- [x] ç¬¬ä¸‰æ–¹ AI API ä»£ç†

#### 6. API è·¯ç”±ç³»ç»Ÿ
- [x] è®¤è¯ API (`/api/auth/*`)
- [x] ç”¨æˆ·ç®¡ç† API (`/api/users/*`)
- [x] æ¨¡å‹é…ç½® API (`/api/models/*`)
- [x] ä¼šè¯ç®¡ç† API (`/api/sessions/*`)
- [x] èŠå¤©åŠŸèƒ½ API (`/api/chat/*`)
- [x] ç³»ç»Ÿè®¾ç½® API (`/api/settings/*`)

#### 7. ä¸­é—´ä»¶å’Œå·¥å…·
- [x] è®¤è¯ä¸­é—´ä»¶
- [x] ç®¡ç†å‘˜æƒé™ä¸­é—´ä»¶
- [x] é”™è¯¯å¤„ç†ä¸­é—´ä»¶
- [x] æ—¥å¿—ä¸­é—´ä»¶
- [x] CORS ä¸­é—´ä»¶
- [x] Token è®¡ç®—å·¥å…·
- [x] åŠ å¯†è§£å¯†å·¥å…·
- [x] è¾“å…¥éªŒè¯ (Zod)

#### 8. ç³»ç»ŸåŠŸèƒ½
- [x] ç³»ç»Ÿè®¾ç½®ç®¡ç†
- [x] ä¸ªäººè®¾ç½®é…ç½®
- [x] å¥åº·æ£€æŸ¥æ¥å£
- [x] åº”ç”¨ä¿¡æ¯æŸ¥è¯¢
- [x] æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- [x] API æµ‹è¯•è„šæœ¬

#### 9. éƒ¨ç½²å’Œè¿ç»´
- [x] Docker å¤šé˜¶æ®µæ„å»º
- [x] Docker Compose é…ç½®
- [x] ç¯å¢ƒå˜é‡ç®¡ç†
- [x] å¥åº·æ£€æŸ¥é…ç½®
- [x] æ—¥å¿—é…ç½®
- [x] å¼€å‘è„šæœ¬

### ğŸ”„ æ ¸å¿ƒæŠ€æœ¯å®ç°

#### è®¤è¯ç³»ç»Ÿ
```typescript
// JWT Token ç”Ÿæˆå’ŒéªŒè¯
const token = AuthUtils.generateToken({
  userId: user.id,
  username: user.username,
  role: user.role,
});

// å¯†ç å®‰å…¨å“ˆå¸Œ
const hashedPassword = await AuthUtils.hashPassword(password);
```

#### API Key åŠ å¯†
```typescript
// åŠ å¯†å­˜å‚¨
const encryptedApiKey = AuthUtils.encryptApiKey(apiKey);

// è§£å¯†ä½¿ç”¨
const decryptedApiKey = AuthUtils.decryptApiKey(encryptedApiKey);
```

#### Token è®¡ç®—
```typescript
// è®¡ç®—å¯¹è¯ Token æ•°é‡
const tokens = await Tokenizer.countConversationTokens(messages);

// æˆªæ–­ä¸Šä¸‹æ–‡
const truncatedContext = await Tokenizer.truncateMessages(
  messages,
  maxTokens
);
```

#### æµå¼å“åº”
```typescript
// SSE æµå¼å“åº”
const stream = new ReadableStream({
  async start(controller) {
    // å¤„ç† AI API æµå¼å“åº”
    // è½¬å‘åˆ°å‰ç«¯
  }
});
```

### ğŸ“Š æ€§èƒ½æŒ‡æ ‡

#### å†…å­˜å ç”¨
- **ç›®æ ‡**: < 500MB
- **å®ç°**: Hono + SQLite è½»é‡çº§æ¶æ„
- **ä¼˜åŒ–**: æŒ‰éœ€åŠ è½½ï¼Œè¿æ¥æ± ç®¡ç†

#### å“åº”æ—¶é—´
- **API å¤„ç†**: < 100ms
- **æ•°æ®åº“æŸ¥è¯¢**: < 50ms (SQLite)
- **æµå¼å“åº”**: å®æ—¶ä¼ è¾“

#### å¹¶å‘èƒ½åŠ›
- **æ”¯æŒ**: 100+ å¹¶å‘ç”¨æˆ·
- **æ¶æ„**: äº‹ä»¶é©±åŠ¨ï¼Œéé˜»å¡ I/O

### ğŸ” å®‰å…¨ç‰¹æ€§

#### è®¤è¯å®‰å…¨
- JWT Token æœ‰æ•ˆæœŸæ§åˆ¶
- å¯†ç å¼ºåº¦éªŒè¯
- é˜²æš´åŠ›ç ´è§£ (å¯æ‰©å±•)

#### æ•°æ®å®‰å…¨
- API Key AES åŠ å¯†å­˜å‚¨
- å¯†ç  bcrypt å“ˆå¸Œ
- SQL æ³¨å…¥é˜²æŠ¤ (Prisma)

#### è®¿é—®æ§åˆ¶
- åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- èµ„æºè®¿é—®éªŒè¯
- CORS è·¨åŸŸä¿æŠ¤

### ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„

```
packages/backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/           # API è·¯ç”± (6ä¸ªæ¨¡å—)
â”‚   â”œâ”€â”€ db/            # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ middleware/    # ä¸­é—´ä»¶ (3ä¸ª)
â”‚   â”œâ”€â”€ utils/         # å·¥å…·å‡½æ•° (2ä¸ª)
â”‚   â”œâ”€â”€ types/         # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts       # åº”ç”¨å…¥å£
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma  # æ•°æ®åº“æ¶æ„
â”‚   â””â”€â”€ migrations/    # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-db.ts     # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ Dockerfile         # Docker é…ç½®
â””â”€â”€ package.json       # ä¾èµ–é…ç½®
```

### ğŸš€ éƒ¨ç½²æ–¹å¼

#### å¼€å‘ç¯å¢ƒ
```bash
# å®‰è£…ä¾èµ–
pnpm install

# åˆå§‹åŒ–æ•°æ®åº“
pnpm run setup

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm run dev
```

#### ç”Ÿäº§ç¯å¢ƒ
```bash
# Docker éƒ¨ç½²
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### ğŸ“š API æ–‡æ¡£

#### è®¤è¯ç›¸å…³
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

#### æ¨¡å‹ç®¡ç†
- `GET /api/models` - è·å–æ¨¡å‹åˆ—è¡¨
- `POST /api/models` - åˆ›å»ºä¸ªäººæ¨¡å‹
- `POST /api/models/system` - åˆ›å»ºç³»ç»Ÿæ¨¡å‹ (ç®¡ç†å‘˜)

#### èŠå¤©åŠŸèƒ½
- `GET /api/sessions` - è·å–ä¼šè¯åˆ—è¡¨
- `POST /api/sessions` - åˆ›å»ºæ–°ä¼šè¯
- `POST /api/chat/stream` - å‘é€æ¶ˆæ¯ (æµå¼å“åº”)

### ğŸ¯ è®¾è®¡ç›®æ ‡è¾¾æˆ

#### âœ… ä½èµ„æºå ç”¨
- Hono è½»é‡çº§æ¡†æ¶
- SQLite æ–‡ä»¶æ•°æ®åº“
- ä¼˜åŒ–å†…å­˜ä½¿ç”¨

#### âœ… æ˜“äºéƒ¨ç½²
- Docker ä¸€é”®éƒ¨ç½²
- é›¶é…ç½®æ•°æ®åº“
- ç¯å¢ƒå˜é‡é…ç½®

#### âœ… åŠŸèƒ½å®Œæ•´
- å®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿ
- çµæ´»çš„æ¨¡å‹é…ç½®
- æ™ºèƒ½çš„ä¸Šä¸‹æ–‡ç®¡ç†

#### âœ… å®‰å…¨å¯é 
- ç°ä»£è®¤è¯æœºåˆ¶
- æ•°æ®åŠ å¯†å­˜å‚¨
- æƒé™æ§åˆ¶ç³»ç»Ÿ

### ğŸ”„ å¾…æ‰©å±•åŠŸèƒ½ (V1.1)

#### å‰ç«¯ç•Œé¢
- React/Next.js å‰ç«¯åº”ç”¨
- ç°ä»£åŒ– UI ç»„ä»¶
- å“åº”å¼è®¾è®¡

#### é«˜çº§åŠŸèƒ½
- æ–‡ä»¶ä¸Šä¼ æ”¯æŒ
- èŠå¤©å¯¼å‡ºåŠŸèƒ½
- ç”¨æˆ·ä¸»é¢˜è®¾ç½®

#### è¿ç»´åŠŸèƒ½
- æ—¥å¿—åˆ†æ
- ç›‘æ§å‘Šè­¦
- æ€§èƒ½ä¼˜åŒ–

### ğŸ“ˆ åç»­è§„åˆ’ (V2.0)

#### é•¿æœŸè®°å¿†
- å‘é‡æ•°æ®åº“é›†æˆ
- å¯¹è¯æ‘˜è¦åŠŸèƒ½
- è·¨ä¼šè¯è®°å¿†

#### å¤šæ¨¡æ€æ”¯æŒ
- å›¾ç‰‡è¾“å…¥å¤„ç†
- è¯­éŸ³è¾“å…¥è¯†åˆ«
- å¤šåª’ä½“æ¶ˆæ¯

#### åˆ†å¸ƒå¼éƒ¨ç½²
- å¾®æœåŠ¡æ¶æ„
- è´Ÿè½½å‡è¡¡
- å®¹å™¨ç¼–æ’

## ğŸ‰ æ€»ç»“

AI Chat Platform åç«¯å®ç°å·²ç»å®Œæˆäº† PRD ä¸­å®šä¹‰çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

1. **å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ** - JWT è®¤è¯ï¼Œè§’è‰²æƒé™æ§åˆ¶
2. **çµæ´»çš„æ¨¡å‹é…ç½®ç®¡ç†** - ä¸ªäºº/ç³»ç»Ÿæ¨¡å‹ï¼ŒAPI Key åŠ å¯†
3. **æ™ºèƒ½çš„èŠå¤©åŠŸèƒ½** - ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œæµå¼å“åº”
4. **å®Œå–„çš„ API æ¥å£** - RESTful è®¾è®¡ï¼Œå®Œæ•´çš„ CRUD æ“ä½œ
5. **å®‰å…¨çš„æ¶æ„è®¾è®¡** - æ•°æ®åŠ å¯†ï¼Œæƒé™æ§åˆ¶ï¼Œè¾“å…¥éªŒè¯
6. **ä¾¿æ·çš„éƒ¨ç½²æ–¹æ¡ˆ** - Docker å®¹å™¨åŒ–ï¼Œä¸€é”®å¯åŠ¨

åç«¯æœåŠ¡å·²ç»å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ºå‰ç«¯åº”ç”¨æä¾›å®Œæ•´çš„ API æ”¯æŒã€‚æ‰€æœ‰æ¥å£éƒ½ç»è¿‡è®¾è®¡éªŒè¯ï¼Œç¬¦åˆç°ä»£ Web åº”ç”¨çš„æœ€ä½³å®è·µã€‚